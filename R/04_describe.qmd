```{r}
library(ggplot2)
library("tidyverse")
```

```{r}

prostate_data_augment<-read_delim("../data/03_dat_aug.tsv")

#Destribution of Age based on whether the patient has passed away or not
age_status_summary <- prostate_data_augment %>%
  group_by(stage) |>
  filter(!is.na(age))|>
  summarise(mean_age = mean(age),
            median_age = median(age),
            min_age = min(age),
            max_age = max(age))
age_status_summary
```


```{r}
plot <-ggplot(prostate_data_augment,aes(x = age,fill = as.factor(stage))) +
  geom_density(alpha=0.5) +
  labs(title = "Distribution of Age based on Cancer Stage",
       x = "Age",
       y = "Density",
       fill = "Status") +
  scale_fill_manual(values = c("blue", "red"), name = NULL, labels = c("Stage 3", "Stage 4")) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
plot


```

```{r}
#| label: Mean of a few different parameters
prostate_data_augment|>
  filter(!is.na(age))|>
  summarise(mean_age = mean(age), mean_haemologbin = mean(`Serum haemoglobin level`), mean_sbp = mean(`Systolic blood pressure`), mean_dbp = mean(`Diastolic blood pressure`))
```


```{r}
#Cause of death across Age groups
plot2<-prostate_data_augment |>
  filter(!is.na(`Cause of Death`)) |>
  ggplot(aes(x = `Cause of Death`, fill = as.factor(`Age group`))) +
  geom_bar(position = "dodge") +
  labs(title = "Cause of Death across Age Groups",
       x = "Cause of Death",
       y = "Number of Cases") +
  theme(legend.position = "bottom", 
      axis.text.x = element_text(angle = 45,hjust=1,size=10), 
      axis.text.y = element_text(size =10)) +
  scale_fill_manual(values = c("tomato2", "skyblue2", "palegreen3"), name = "Age group", labels = c("< 75 years", "75 to 80 years", "> 80 years")) 
plot2
```

```{r}
# History of cvd - tumor size boxplot
cvd_lesion_plot<-prostate_data_augment|>
  filter(!is.na(`Primary lesion size(cm^2)`)) |>
  ggplot(aes(x = factor(`stage` ), y = `Primary lesion size(cm^2)`)) +
  geom_boxplot() +
  labs(
    x = "Cancer Stage",
    y = "Lesion size",
    title = "Boxplot of Primary Lesion Size by Cancer Stage"
  ) +
  scale_x_discrete(labels = c("Stage 3", "Stage 4"))
cvd_lesion_plot
```

```{r}

# Correlation of gleason stage - hemoglobin colored by cancer stage
hemo_and_risk_plot<-prostate_data_augment|>
  filter(!is.na(`Risk`))|>
  ggplot(aes(x = `Risk`, y = `Serum haemoglobin level`, color = as.factor(stage))) +
  geom_point() +
  labs(
    x = "Risk",
    y = "Hemoglobin Level",
    title = "Correlation of Hemoglobin with Risk by Cancer Stage")+
  scale_color_discrete(name = "Cancer Stage",labels = c("Stage 3", "Stage 4"))
hemo_and_risk_plot
```

```{r}
#Correlation of tumor size - hemoglobin
tumor_age_adjusted_haem<-prostate_data_augment |>
  filter(!is.na(`Primary lesion size(cm^2)`)) |>
  ggplot(aes(x = `Primary lesion size(cm^2)`, y = `Age Adjusted Haemoglobin`, fill = Dosage)) +
  geom_density_2d_filled() +
  labs(fill = "Dosage")

tumor_age_adjusted_haem
```

```{r}

#Correlation of tumor - activity level 
ggplot(prostate_data_augment, aes(x = age, y = `Primary lesion size(cm^2)`, fill = `Activity Level`)) +
  geom_point() +
  labs(
    x = "Age",
    y = "Tumor Size",
    title = "Correlation of Age with Tumor Size by Activity Level"
  )

prostate_data_augment |>
mutate(`Dosage` = case_when(
    `Dosage` == "Low" ~ "0")) |>
  mutate(`Dosage` = as.numeric(`Dosage`)) |>
   mutate(`Dosage` = replace_na(`Dosage`,1))
 

```

```{r}
prostate_data_augment |>
  group_by(stage) |>
  filter(!is.na(`Gleason stage`)) |>
  summarise(mu = mean(`Gleason stage`))
```

```{r}
prostate_data_augment |>
  group_by(stage) |>
  filter(!is.na(`Primary lesion size(cm^2)`)) |>
  summarise(mu = mean(`Primary lesion size(cm^2)`))

```

