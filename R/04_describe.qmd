```{r}
library(ggplot2)
library("tidyverse")
library(dplyr)
```

```{r}
# First load the cleaned data 
prostate_data_augment<-read_delim("../data/03_dat_aug.tsv")

#We check if the data is tidy using the glimple() method
data_types <- glimpse(prostate_data_augment)
data_types
```
``` {r}

```


```{r}

#Destribution of Age based on stage
age_status_summary <- prostate_data_augment %>%
  group_by(stage) |>
  filter(!is.na(age))|>
  summarise(mean_age = mean(age),
            median_age = median(age),
            min_age = min(age),
            max_age = max(age))
age_status_summary
```

```{r}
age_distribution <-ggplot(prostate_data_augment,aes(x = age,fill = as.factor(stage))) +
  geom_density(alpha=0.5) +
  labs(title = "Distribution of Age based on Cancer Stage",
       x = "Age",
       y = "Density",
       fill = "Status") +
  scale_fill_manual(values = c("blue", "red"), name = NULL, labels = c("Stage 3", "Stage 4")) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
plot
```

```{r}
#Cause of death across Age groups
plot2<-prostate_data_augment |>
  filter(!is.na(`Cause of Death`)) |>
  ggplot(aes(x = `Cause of Death`, fill = as.factor(`Age group`))) +
  geom_bar(position = "dodge") +
  labs(title = "Cause of Death across Age Groups",
       x = "Cause of Death",
       y = "Number of Cases") +
  theme(legend.position = "bottom", 
      axis.text.x = element_text(angle = 45,hjust=1,size=10), 
      axis.text.y = element_text(size =10)) +
  scale_fill_manual(values = c("tomato2", "skyblue2", "palegreen3"), name = "Age group", labels = c("< 75 years", "75 to 80 years", "> 80 years")) 
plot2
```
```{r}
#Association of weight index and age across all types of cancer colored by Risk

weight_age_across_cancers<-prostate_data_augment|> 
  filter(!is.na(`Cause of Death`))|>
  filter(!is.na(Risk))|>
  ggplot(aes(x = age, y = `Weight index`, color = Risk)) +
  geom_point() +
  facet_wrap(~`Cause of Death`)+
  labs()
weight_age_across_cancers
```
For all non-prostatic cancer causes, low weight index showed high risk for patients across all ages especially those above 70.


```{r}
# Boxplot of size of the tumor in each stage
lesion_on_stage_plot<-prostate_data_augment|>
  filter(!is.na(`Primary lesion size(cm^2)`)) |>
  ggplot(aes(x = factor(`stage` ), y = `Primary lesion size(cm^2)`)) +
  geom_boxplot() +
  labs(
    x = "Cancer Stage",
    y = "Lesion size",
    title = "Boxplot of Primary Lesion Size by Cancer Stage"
  ) +
  scale_x_discrete(labels = c("Stage 3", "Stage 4"))
lesion_on_stage_plot
```

The size of the tumor was on average bigger on stage 4

```{r}
#Tumor size and hemoglobin correlation on each stage colored by Risk

hem_and_tumor_plot <-prostate_data_augment|>
  filter(!is.na(`Primary lesion size(cm^2)`))|>
  filter(!is.na(Risk))|>
  ggplot(aes(x = `Serum haemoglobin level`, 
             y = `Primary lesion size(cm^2)`, 
             color = Risk)) +
  geom_point() +
  facet_wrap(~stage) +
  labs(x = "Haemoglobin", y = "Tumour Size", color = "Risk") +
  theme_minimal()
hem_and_tumor_plot 
```
Tumor size and hemoglobin don't have much correlation but on each stage of the cancer. However, high hemoglobin levels show higher risk for patients and thus higher number of gleason stage.


```{r}

# Correlation of gleason stage -Tumor size colored by cancer stage
gleason_and_tumor_by_stage<-prostate_data_augment|>
  filter(!is.na(`Primary lesion size(cm^2)`))|>
  filter(!is.na(`Gleason stage`))|>
  ggplot(aes(x = `Gleason stage`,
             y = `Primary lesion size(cm^2)`, 
             color = as.factor(stage))) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(
    x = "Gleason Stage",
    y = "Lesion size",
    title = "Lesion size vs Gleason Stage by Cancer Stage")+
  scale_color_discrete(name = "Cancer Stage",labels = c("Stage 3", "Stage 4"))
gleason_and_tumor_by_stage
```
In each stage, there was a possitive correlation between the size of the lesion and the Gleason Stage. The higher the stage, the bigger the size. 

```{r}
# Relationship Between Prostate Acid Levels and Bone Metastases
ap_bm_relationship <-prostate_data_augment|>
  filter(!is.na(Risk))|>
  ggplot(aes(x = ap, y = bm)) +
  geom_point(aes(color = factor(bm)), size = 3) +
  geom_smooth(method = "glm", method.args = list(family = "binomial"), se = FALSE) +
  labs(x = "Prostate Acid Levels", y = "Bone Metastases", color = "Bone Metastases") +
  scale_color_manual(values = c("blue", "red"), labels = c("No Metastases", "Metastases")) +
  ggtitle("Relationship Between Prostate Acid Levels and Bone Metastases") +
  theme_minimal()+
  facet_wrap(~ Risk)

ap_bm_relationship
```
Very high risk patients bone metastasis show higher higher prostatic acid levels

```{r}
prostate_data_augment |>
mutate(`Dosage` = case_when(
    `Dosage` == "Low" ~ "0")) |>
  mutate(`Dosage` = as.numeric(`Dosage`)) |>
   mutate(`Dosage` = replace_na(`Dosage`,1))
 

```

```{r}
prostate_data_augment |>
  group_by(stage) |>
  filter(!is.na(`Gleason stage`)) |>
  summarise(mu = mean(`Gleason stage`))
```

```{r}
prostate_data_augment |>
  group_by(stage) |>
  filter(!is.na(`Primary lesion size(cm^2)`)) |>
  summarise(mu = mean(`Primary lesion size(cm^2)`))

```

```{r}
#| label: Mean of a few different parameters
prostate_data_augment|>
  filter(!is.na(age))|>
  summarise(mean_age = mean(age), mean_haemologbin = mean(`Serum haemoglobin level`), mean_sbp = mean(`Systolic blood pressure`), mean_dbp = mean(`Diastolic blood pressure`))

```
