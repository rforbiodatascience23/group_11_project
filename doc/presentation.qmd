---
title: "Group 11: Analysis of Prostate Cancer Data"
format:
  revealjs:
    embed-resources: true
---

```{r}
library(knitr)
```

Note ALWAYS WORK ON YOUR CHUNK TO AVOID CONFLICTS

## Introduction {.centered}

Our analysis exploits data from a randomised clinical trial by Byar & Greene that compares treatment of patients with prostate cancer in stages 3 and 4. Treatment consisted of different doses of diethylstilbestrol (DES). Our aim is to investigate correlations, trends, or predictive models related to prostate cancer and patient outcomes. Data are publicly available in : https://hbiostat.org/data/repo/prostate.xls

## Description

The initial dataset contains information related to 502 observations of patients with prostate cancer across 18 variables. These variables encompass diverse information including patient demographics, medical history, treatment received, and health status.

The raw data were: + loaded, + cleaned\
+ augmented + described + modelled. and the process of arriving at results is done in a reproducible manner.

## Tidy data

-   For instance we separate "rx" into three columns; "Treatment regime", "mg" and "Drug"

```{r}
#| out.width = '50%',
#| fig.align = 'center'
knitr::include_graphics("figs/raw_dataset.png")
```

## Results {.centered}

# Data exploration

The data consists of 25 features with 502 rows. First,we look at the NA values

```{r}
knitr::include_graphics("../results/na_percentage.png")
```

Analyzing the dataset reveals that the proportion of missing values, NA, maintains below 2.5% of the overall dataset across most features. In respect to the entire dataset size, this amount of missingness looks small. The "Cause of Death" feature is an exception, with NA entries accounting for around 29.5% of the total data. However, this particular occurrence does not pose a concern due to the contextual correlation with the "status" feature. In this dataset, an NA value in the "Cause of Death" feature signifies that the corresponding patient is alive, as per the interpretation of the "status" feature. Next, we take a look at the summary statistics:

```{r}
#Summary statistics
```

The summary statistics indicate that the mean age of the patients is approximately 71.5 years. Among them, 42.43% have a documented history of cardiovascular disease. Additionally, the average systolic and diastolic blood pressures are recorded at 14.35 and 8.149, respectively. This suggests that while the systolic blood pressure tends to be elevated, the diastolic pressure remains within the normal range, considering that only hundreds and tens are recorded. Furthermore, the prevalence of bone metastasis appears to be comparatively lower.

```{r}
knitr::include_graphics("../results/causes_across_groups.png")
```

Across various age groups, a notable trend emerges in the causes of death among patients affected by prostate cancer and cardiovascular diseases. Specifically, a significant majority of individuals who succumbed to prostate cancer or cardiovascular diseases were under the age of 75. Those above 80 had the lowest deaths across all recorded causes.

```{r}
knitr::include_graphics("../results/wt_age_across_cancers.png")
```

A tendency was also revealed across the causes of death: those with a low Weight Index, defined as Weight in kilograms - Height in centimeters + 200, were significantly more likely to die, especially those over the age of 70. This increased risk was prevalent across all causes of mortality. Patients at all reported ages were consistently identified as being at high risk for prostate cancer. Focusing now in prostate cancer, we took a look at a possible relationship between haemoglobin levels and the size of the lesion.

```{r}
knitr::include_graphics("../results/haem_vs_lesion.png")
```

The analysis indicates an absence of correlation between haemoglobin levels and lesion size across the two cancer stages. However, a noteworthy finding emerged; patients with elevated levels of haemoglobin in both stages were consistently associated with a higher risk profile. There was however a correlation between the Gleason stage and the lesion size. Data indicated that as the Gleason stage increased so did the size of the lesion in both cancer stages.

```{r}
knitr::include_graphics("../results/gleason_vs_lesion.png")
```

Finally, we expored a possible relationship between Serum prostatic acid phosphatase and Bone Metastases.What we found was that in patients with high risk, bone metastases was prevelant at low levels of the phosphatase.

```{r}
knitr::include_graphics("../results/ap_vs_bm.png")
```


## PCA ORLA
<font size="5"> There were 3 main steps to this PCA, outlined below:
Looking at the data in PC coordinates.
Looking at the rotation matrix.
Looking at the variance explained by each PC.

Here, the data in PC coordinates is plotted 
```{r}
pca_fit|>
  augment(prostate_data_augment)|> # add original dataset back in
  ggplot(aes(.fittedPC1, .fittedPC2, color = `stage`)) + 
  geom_point(size = 1.5)
```



## Logistic Regression Modelling

<font size="5"> The objective is to predict *dosage* based on the bone metastasis(*bm)*, *weight* i*ndex, primary lesion size* and a*ge adjusted haemoglobin* for patients with 3 and 4 prostate cancer stage respectivelly. The coefficients of the above predictors are showed below as well as their significance as indicated by their p.values. </font>

::: columns
::: {.column width="50%"}
```{r}
#| out.width = '100%',
#| fig.align = 'left'
knitr::include_graphics("../results/glm_01.png")

```
:::

::: {.column width="50%"}
```{r}
#| out.width = '100%',
#| fig.align = 'right'
knitr::include_graphics("../results/glm_02.png")
```
:::
:::

## Discussion {.centered}

## PCA discussion

<<<<<<< HEAD
The arrows show the direction and strength of the contribution from each variable to the first two PCs. 
Here it is clear that Treatment regime had a very small but positive contribution to the PCs. Age and history of CVD seem to be quite related as in stage, Gleaseon stage and primary lesion size, indicating that they are positively correlated and contribute similarly to the variation captured by the PCs.
```{r}
arrow_style <- arrow(
  angle = 20, ends = "first", type = "closed", length = grid::unit(8, "pt")
)

# plot rotation matrix
pca_fit %>%
  tidy(matrix = "rotation") %>%
  pivot_wider(names_from = "PC", names_prefix = "PC", values_from = "value") %>%
  ggplot(aes(PC1, PC2)) +
  geom_segment(xend = 0, yend = 0, arrow = arrow_style) +
  geom_text(
    aes(label = column),
    hjust = 1, nudge_x = -0.02, 
    color = "skyblue2"
  ) +
  xlim(-1.25, .5) + ylim(-.5, 1) +
  coord_fixed() 
```

This plot shows that over 25% of the variation is captured by the first component.
This is a somewhat substantial portion of the variability in our data. 

```{r}
pca_fit %>%
  tidy(matrix = "eigenvalues")

pca_fit %>%
  tidy(matrix = "eigenvalues") %>%
  ggplot(aes(PC, percent)) +
  geom_col(fill = "#56B4E9", alpha = 0.8) +
  scale_x_continuous(breaks = 1:9) +
  scale_y_continuous(
    labels = scales::percent_format(),
    expand = expansion(mult = c(0, 0.01))
  ) 
```

=======
>>>>>>> ae7c33214d51c9e5bf8f41d4ae97cfc95856ba71

## Predictors of Dosage for each Cancer Stage ?

-   In our analysis of the Logistic Regression model, we encountered several predictors that did not exhibit significant influence on the dosage prediction per cancer stage.
-   Although valuable insights could be gained from a more explorative analysis, we prioritized to mainly focus on the scopes of the course.
